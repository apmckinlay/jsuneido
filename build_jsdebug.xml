<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<project default="all" name="Build the jsdebug Shared Library">
	<property environment="env"/>
	<condition property="jsdebug-path" value="${env.JSDEBUG_PATH}" else="../jsdebug">
		<isset property="env.JSDEBUG_PATH"/>
	</condition>
	<property name="jsdebug-vs-path" value="${jsdebug-path}/vs/vs12"/>
	<property name="jsdebug-vs-sln" value="vs12.sln"/>
	<property name="jsdebug-msbuild-config" value="Release"/>
	<property name="dll-src-dir-win32-amd64" value="${jsdebug-vs-path}/x64/${jsdebug-msbuild-config}"/>
	<property name="dll-src-dir-win32-x86" value="${jsdebug-vs-path}/${jsdebug-msbuild-config}"/>
	<property name="dll-dst-dir" value="lib"/>

	<target name="all" depends="build-win32-amd64,build-win32-x86"/>

	<target name="rebuild" depends="rebuild-win32-amd64,rebuild-win32-x86"/>

	<target name="clean" depends="clean-win32-amd64,clean-win32-x86"/>

	<target name="build-win32-amd64"
	        description="Use Visual Studio to make the Windows AMD64 version of the dll"
	>
		<exec executable="msbuild" dir="${jsdebug-vs-path}" failonerror="true">
			<arg value="${jsdebug-vs-sln}"/>
			<arg value="/t:Build"/>
			<arg value="/p:Configuration=${jsdebug-msbuild-config};Platform=x64"/>
			<arg value="/m"/>
		</exec>
		<copy file="${dll-src-dir-win32-amd64}/jsdebug.dll" todir="${dll-dst-dir}/win32-amd64"
		      overwrite="true" failonerror="true"
		/>
	</target>

	<target name="clean-win32-amd64">
		<exec executable="msbuild" dir="${jsdebug-vs-path}" failonerror="true">
			<arg value="${jsdebug-vs-sln}"/>
			<arg value="/t:Clean"/>
			<arg value="/p:Configuration=${jsdebug-msbuild-config};Platform=x64"/>
		</exec>
	</target>

	<target name="rebuild-win32-amd64" depends="clean-win32-amd64,build-win32-amd64"/>

	<target name="build-win32-x86"
	        description="Use Visual Studio to make the Windows x86 version of the dll"
	>
		<exec executable="msbuild" dir="${jsdebug-vs-path}" failonerror="true">
			<arg value="${jsdebug-vs-sln}"/>
			<arg value="/t:Build"/>
			<arg value="/p:Configuration=${jsdebug-msbuild-config};Platform=Win32"/>
			<arg value="/m"/>
		</exec>
		<copy file="${dll-src-dir-win32-x86}/jsdebug.dll" todir="${dll-dst-dir}/win32-x86"
			  overwrite="true" failonerror="true"
		/>
	</target>

	<target name="clean-win32-x86">
		<exec executable="msbuild" dir="${jsdebug-vs-path}" failonerror="true">
			<arg value="${jsdebug-vs-sln}"/>
			<arg value="/t:Clean"/>
			<arg value="/p:Configuration=${jsdebug-msbuild-config};Platform=Win32"/>
		</exec>
	</target>

	<target name="rebuild-win32-x86" depends="clean-win32-x86,build-win32-x86"/>
</project>

